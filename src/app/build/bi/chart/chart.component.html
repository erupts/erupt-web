<nz-spin [nzSpinning]="chart.loading">
  @switch (chart.type) {
    @case (chartType.Alert) {
      @if (ready && data && data.length) {
        <nz-alert nzType="info" [nzMessage]="alertMessage" style="margin-bottom: 12px"></nz-alert>
        <ng-template #alertMessage>
          @for (d of data; track d) {
            <p [innerHTML]="d.x | safeHtml" style="margin-bottom: 0"></p>
          }
        </ng-template>
      }
    }
    @default {
      <nz-card [nzTitle]="chart.name" nzSize="small" [nzBodyStyle]="{padding:'0'}" [nzHoverable]="true"
        [nzExtra]="extraTemplate" style="margin-bottom: 12px">
        <div [ngClass]="open?'card-show':'card-hide'">
          @if (!ready) {
            <div [id]='chart.code' [ngStyle]="{height:chart.height+'px'}"
              style='width:100%;display: flex;flex-direction: column;align-items:center;justify-content: center;'>
              <i nz-icon nzType="pie-chart" nzTheme="twotone" style="font-size: 36px"></i>
            </div>
          }
          @if (ready) {
            @switch (chart.type) {
              @case (chartType.tpl) {
                @if (!src) {
                  <nz-empty nzNotFoundImage="simple" [nzNotFoundContent]="null"
                    class="flex-center-center"
                    [style]="{height:chart.height+'px'}">
                  </nz-empty>
                }
                @if (src) {
                  <erupt-iframe [url]="src" [style]="{height:chart.height+'px',paddingTop:'1px'}">
                  </erupt-iframe>
                }
              }
              @case (chartType.table) {
                <div [ngStyle]="{height:chart.height+'px'}" style="overflow: auto">
                  <erupt-chart-table #chartTable [id]="chart.code"></erupt-chart-table>
                </div>
              }
              @case (chartType.Number) {
                @if (!data||data.length==0) {
                  <nz-empty nzNotFoundImage="simple" [nzNotFoundContent]="null"
                    class="flex-center-center">
                  </nz-empty>
                }
                @if (data&&data.length) {
                  <div style="padding: 12px;text-align: center;" [id]="chart.code">
                    <div sg-container="{{data.length}}">
                      @for (d of data; track d) {
                        <sg>
                          <nz-statistic style="margin-bottom: 16px;"
                            [nzValue]="d[dataKeys[0]]||0"
                            [nzTitle]="d[dataKeys[1]]"
                            [nzValueStyle]="this.chart.chartOption"
                          ></nz-statistic>
                        </sg>
                      }
                    </div>
                  </div>
                }
              }
              @default {
                <div [id]='chart.code' style='width:100%;' [ngStyle]="{height:chart.height+'px'}">
                  @if (!data||data.length==0) {
                    <nz-empty nzNotFoundImage="simple" [nzNotFoundContent]="null"
                      class="flex-center-center">
                    </nz-empty>
                  }
                </div>
              }
            }
          }
        </div>
      </nz-card>
      <ng-template #extraTemplate>
        @if (chart.remark) {
          <span nz-icon nzType="question-circle" nzTheme="outline" nz-tooltip
          [nzTooltipTitle]="chart.remark"></span>
          &nbsp;<nz-divider nzType="vertical"></nz-divider>&nbsp;
        }
        @if (plot) {
          <i nz-icon nzType="file-image" nzTheme="outline" (click)="downloadChartImage()"></i>
          &nbsp;<nz-divider nzType="vertical"></nz-divider>&nbsp;
        }
        @if (bi.export && data && data.length>0) {
          @if (downloading) {
            <i nz-icon [nzType]="'loading'"></i>
          }
          @if (!downloading) {
            <i nz-icon nzType="download" nzTheme="outline"
            (click)="downloadChartData()"></i>
          }
          &nbsp;<nz-divider nzType="vertical"></nz-divider>&nbsp;
        }
        <i nz-icon nzType="reload" (click)="update(true)"></i>
        &nbsp;<nz-divider nzType="vertical"></nz-divider>&nbsp;
        @if (open) {
          <span nz-icon nzType="down" nzTheme="outline" (click)="open=false"></span>
        }
        @if (!open) {
          <span nz-icon nzType="left" nzTheme="outline" (click)="open=true"></span>
        }
      </ng-template>
    }
  }
</nz-spin>
