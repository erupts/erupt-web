<div class="flow-dashboard">
  <!-- 主要内容区域 -->
  <div class="main-content">
    <!-- 左侧分类导航 -->
    <div class="category-sidebar">
      <div class="category-header">
        <h3>流程分类</h3>
        <button
          nz-button
          nzType="text"
          nzSize="small"
          (click)="refreshData()"
          [nzLoading]="loading">
          <i nz-icon nzType="reload"></i>
        </button>
      </div>
      <div class="category-list">
        @for (category of categories; track category) {
          <div
            class="category-item"
            [class.active]="selectedCategory === category.key"
            (click)="onCategorySelect(category.key)">
            <span class="category-name">{{ category.name }}</span>
            @if (category.key) {
              <span class="category-count">
                ({{ getCategoryFlowCount(category.key) }})
              </span>
            }
          </div>
        }
      </div>
    </div>

    <!-- 右侧流程内容 -->
    <div class="content-area">
      <!-- 搜索框 -->
      @if (!loading) {
        <div class="search-container">
          <nz-input-group nzPrefixIcon="search" nzSize="default">
            <input
              type="text"
              nz-input
              style="width: 200px"
              [(ngModel)]="searchKeyword"
              (ngModelChange)="onSearchChange()"
              placeholder="搜索流程名称...">
          </nz-input-group>
        </div>
      }

      <!-- 加载状态 -->
      @if (loading) {
        <div class="loading-container">
          <nz-spin nzSize="large">
            <div class="loading-text">加载中...</div>
          </nz-spin>
        </div>
      }

      <!-- 流程内容 -->
      @if (!loading) {
        <div class="flow-groups">
          <!-- 空状态 -->
          @if (filteredFlowGroups.length === 0) {
            <div class="empty-state">
              <i nz-icon nzType="inbox" nzTheme="outline"></i>
              @if (!searchKeyword) {
                <p>暂无流程数据</p>
              }
              @if (searchKeyword) {
                <p>未找到匹配的流程</p>
              }
              @if (!searchKeyword) {
                <button nz-button nzType="primary" (click)="refreshData()">
                  刷新数据
                </button>
              }
              @if (searchKeyword) {
                <button nz-button nzType="default" (click)="searchKeyword = ''; onSearchChange()">
                  清除搜索
                </button>
              }
            </div>
          }
          <!-- 流程分组 -->
          @for (group of filteredFlowGroups; track group) {
            <div class="group-section">
              <h3 class="group-title">
                {{ group.title }}
                <span class="group-count">({{ group.flows.length }})</span>
              </h3>
              <div class="flow-grid">
                @for (flow of group.flows; track flow) {
                  @if (flow.enable) {
                    <div class="flow-item"
                      (click)="launchFlow(flow)"
                      [ngClass]="{'flow-disabled': !flow.enable}">
                      <div class="flow-icon" [style]="{background:flow.color}">
                        <span [classList]="flow.icon"></span>
                      </div>
                      <div class="flow-info">
                        <div class="flow-name">{{ flow.name }}</div>
                        @if (flow.remark) {
                          <div class="flow-desc">{{ flow.remark }}</div>
                        }
                      </div>
                    </div>
                  }
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
