<div class="flow-approval-container">
  <!-- 左侧导航栏 -->
  <div class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="search-section">
        <span nz-icon nzType="search" nzTheme="outline"></span>
        <span class="search-text">搜索</span>
      </div>
      <button nz-button nzType="text" nzSize="small" class="menu-toggle">
        <span nz-icon nzType="menu" nzTheme="outline"></span>
      </button>
    </div>

    <div class="navigation-menu">
      <ul nz-menu
          nzMode="inline"
          [nzInlineCollapsed]="sidebarCollapsed"
          (nzClick)="onMenuClick($event)"
          class="approval-menu">

        <!-- 待办 -->
        <li nz-menu-item nzKey="todo">
          <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
          <span class="menu-title">待办</span>
          <nz-badge [nzCount]="5" nzShowZero class="menu-badge"></nz-badge>
        </li>

        <!-- 已办 -->
        <li nz-submenu nzKey="done" nzTitle="已办" nzIcon="check-circle">
          <ul>
            <li nz-menu-item nzKey="done-purchase">采购申请</li>
            <li nz-menu-item nzKey="done-expense">费用报销</li>
          </ul>
        </li>

        <!-- 抄送我 -->
        <li nz-menu-item nzKey="cc">
          <span nz-icon nzType="copy" nzTheme="outline"></span>
          <span class="menu-title">抄送我</span>
          <nz-badge [nzCount]="2" nzShowZero class="menu-badge"></nz-badge>
        </li>

        <!-- 已发起 -->
        <li nz-submenu nzKey="initiated" nzTitle="已发起" nzIcon="rocket">
          <ul>
            <li nz-menu-item nzKey="initiated-purchase">采购申请</li>
            <li nz-menu-item nzKey="initiated-expense">费用报销</li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="sidebar-footer">
      <button nz-button nzType="text" nzSize="small" (click)="toggleSidebar()">
        <span nz-icon nzType="menu-fold" nzTheme="outline"></span>
        <span class="collapse-text">收起导航</span>
      </button>
    </div>
  </div>

  <!-- 主内容区域 -->
  <div class="main-content">
    <!-- 中间列表区域 -->
    <div class="list-section">
      <div class="list-header">
        <div class="time-filter">
          <span>所有时间</span>
          <span nz-icon nzType="down" nzTheme="outline"></span>
        </div>
        <div class="separator"></div>
        <button nz-button nzType="text" nzSize="small">
          <span nz-icon nzType="more" nzTheme="outline"></span>
        </button>
      </div>

      <div class="approval-list">
        <div
          class="approval-item"
          *ngFor="let item of approvalList"
          [class.active]="selectedItem?.id === item.id"
          (click)="selectItem(item)"
        >
          <div class="item-header">
            <h3 class="item-title">{{ item.type }}</h3>
            <nz-tag
              [nzColor]="getStatusColor(item.status)"
              class="status-tag"
            >
              {{ getStatusText(item.status) }}
            </nz-tag>
          </div>
          <div class="item-footer">
            <div class="submitter-info">
              <div class="avatar" [style.background-color]="getAvatarColor(item.submitter.avatar)">
                {{ item.submitter.avatar }}
              </div>
              <span class="submitter-name">{{ item.submitter.name }}</span>
            </div>
            <div class="time-info">
              <span class="process-time" *ngIf="item.processTime">处理时间 {{ item.processTime }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右侧详情区域 -->
    <div class="detail-section" *ngIf="selectedItem">
      <div class="detail-header">
        <div class="header-left">
          <span class="item-id">编号: {{ selectedItem.id }}</span>
        </div>
        <div class="header-right">
          <button nz-button nzType="text" nzSize="small" nz-tooltip nzTooltipTitle="链接">
            <span nz-icon nzType="link" nzTheme="outline"></span>
          </button>
          <button nz-button nzType="text" nzSize="small" nz-tooltip nzTooltipTitle="刷新">
            <span nz-icon nzType="reload" nzTheme="outline"></span>
          </button>
          <button nz-button nzType="text" nzSize="small" nz-tooltip nzTooltipTitle="打印">
            <span nz-icon nzType="printer" nzTheme="outline"></span>
          </button>
          <button nz-button nzType="text" nzSize="small" nz-tooltip nzTooltipTitle="帮助">
            <span nz-icon nzType="question-circle" nzTheme="outline"></span>
          </button>
        </div>
      </div>

      <div class="detail-content">
        <div class="content-header">
          <h1 class="content-title">{{ selectedItem.type }}</h1>
          <nz-tag
            [nzColor]="getStatusColor(selectedItem.status)"
            class="status-tag-large"
          >
            {{ getStatusText(selectedItem.status) }}
          </nz-tag>
        </div>

        <div class="submitter-info-large">
          <div class="avatar-large" [style.background-color]="getAvatarColor(selectedItem.submitter.avatar)">
            {{ selectedItem.submitter.avatar }}
          </div>
          <div class="submitter-details">
            <span class="submitter-name-large">{{ selectedItem.submitter.name }}</span>
            <span class="submitter-dept">{{ selectedItem.submitter.department }}</span>
            <span class="submit-time">提交于 {{ selectedItem.submitTime }}</span>
          </div>
        </div>

        <!-- 标签页导航 -->
        <nz-tabset
          class="detail-tabs"
          (nzSelectedIndexChange)="onTabChange($event)"
          [nzSelectedIndex]="activeTabIndex"
        >
          <nz-tab nzTitle="审批详情">
            <div class="tab-content">
              <div class="section">
                <h3 class="section-title">| 审批详情</h3>
                <nz-descriptions nzBordered [nzColumn]="1" class="detail-descriptions">
                  <nz-descriptions-item nzTitle="采购事由">
                    {{ selectedItem.reason }}
                  </nz-descriptions-item>
                  <nz-descriptions-item nzTitle="采购类别">
                    {{ selectedItem.category }}
                  </nz-descriptions-item>
                  <nz-descriptions-item nzTitle="期望交付时间">
                    {{ selectedItem.expectedDelivery }}
                  </nz-descriptions-item>
                </nz-descriptions>
              </div>

              <div class="section">
                <h3 class="section-title">费用明细</h3>
                <nz-table
                  #expenseTable
                  [nzData]="expenseDetails"
                  [nzShowPagination]="false"
                  [nzSize]="'small'"
                  class="expense-table"
                >
                  <thead>
                    <tr>
                      <th>名称</th>
                      <th>规格</th>
                      <th>数量</th>
                      <th>金额</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let detail of expenseDetails">
                      <td>{{ detail.name }}</td>
                      <td>{{ detail.specification }}</td>
                      <td>{{ detail.quantity }}</td>
                      <td>
                        <span class="amount-highlight">¥{{ detail.amount.toFixed(2) }} CNY-人民币元</span>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>

                <div class="expense-summary">
                  <nz-descriptions [nzColumn]="2" class="summary-descriptions">
                    <nz-descriptions-item nzTitle="费用明细汇总-数量">
                      {{ getTotalQuantity() }}
                    </nz-descriptions-item>
                    <nz-descriptions-item nzTitle="费用明细汇总-金额">
                      <span class="amount-highlight">¥{{ getTotalAmount().toFixed(2) }} CNY-人民币元</span>
                    </nz-descriptions-item>
                  </nz-descriptions>
                </div>
              </div>
            </div>
          </nz-tab>

          <nz-tab nzTitle="审批记录">
            <div class="tab-content">
              <div class="section">
                <h3 class="section-title">| 审批记录</h3>
                <nz-table
                  #recordsTable
                  [nzData]="approvalRecords"
                  [nzShowPagination]="false"
                  [nzSize]="'small'"
                  class="records-table"
                >
                  <thead>
                    <tr>
                      <th>节点名称</th>
                      <th>审批人</th>
                      <th>审批结果</th>
                      <th>审批意见</th>
                      <th>审批时间</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let record of approvalRecords">
                      <td>{{ record.nodeName }}</td>
                      <td>
                        <div class="approver-info">
                          <div class="avatar-small" [style.background-color]="getAvatarColor(record.approver.avatar)">
                            {{ record.approver.avatar }}
                          </div>
                          <span class="approver-name">{{ record.approver.name }}</span>
                        </div>
                      </td>
                      <td>
                        <nz-tag nzColor="success">{{ record.result }}</nz-tag>
                      </td>
                      <td>{{ record.opinion || '-' }}</td>
                      <td>
                        <div class="time-info">
                          <div>{{ record.time }}</div>
                          <div class="time-detail">7月30日 23:34</div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
          </nz-tab>

          <nz-tab nzTitle="全文评论 (1)">
            <div class="tab-content">
              <div class="section">
                <nz-empty
                  nzNotFoundImage="simple"
                  nzNotFoundContent="暂无评论内容"
                ></nz-empty>
              </div>
            </div>
          </nz-tab>
        </nz-tabset>
      </div>

      <!-- 固定在右侧底部的功能按钮 -->
      <div class="fixed-bottom-actions">
        <div class="action-buttons">
          <button nz-button nzType="primary" nzSize="default" (click)="startGroupChat()">
            <span nz-icon nzType="message" nzTheme="outline"></span>
            发起群聊
          </button>
          <button nz-button nzSize="default" (click)="cc()">
            <span nz-icon nzType="send" nzTheme="outline"></span>
            抄送
          </button>
          <button nz-button nzSize="default" (click)="modify()">
            <span nz-icon nzType="edit" nzTheme="outline"></span>
            修改
          </button>
          <button nz-button nzSize="default" (click)="recall()">
            <span nz-icon nzType="undo" nzTheme="outline"></span>
            撤销
          </button>
          <button nz-button nzSize="default" (click)="resubmit()">
            <span nz-icon nzType="redo" nzTheme="outline"></span>
            再次提交
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
