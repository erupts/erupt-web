<div class="notice-container">
    <!-- 头部 -->
    <div class="notice-header">
        <div class="header-title">
            <span nz-icon nzType="bell" nzTheme="outline"></span>
            <span class="title-text">{{ 'notice.center' | translate }}</span>
        </div>
        <button nz-button nzType="text" nzSize="small" (click)="close()" class="close-btn">
            <span nz-icon nzType="close"></span>
        </button>
    </div>

    <!-- 消息列表视图 -->
    <div class="notice-content">
        <div class="channel-segmented">
            <div class="channel-header">
                <nz-segmented [nzBlock]="true"
                              [nzOptions]="channelOptions"
                              [(ngModel)]="selectedChannelIndex"
                              (ngModelChange)="onChannelChange($event)"
                              [nzSize]="'small'">
                </nz-segmented>
                <button nz-button
                        nzType="link"
                        nzSize="small"
                        *ngIf="selectedChannelIndex === 0 && messages.length > 0"
                        (click)="markAllAsRead()"
                        class="read-all-btn">
                    <span nz-icon nzType="check" nzTheme="outline"></span>
                    {{ 'notice.readAll' | translate }}
                </button>
            </div>
        </div>

        <!-- 消息列表 -->
        <nz-list [nzDataSource]="messages" [nzLoading]="loadingMessages" [nzSize]="'small'"
                 class="message-list">
            <nz-list-item *ngFor="let item of messages"
                         (click)="selectedChannelIndex === 0 ? viewMessageDetail(item) : viewAnnouncementDetail(item)"
                         class="message-item">
                <div style="width: 100%">
                    <div class="message-header">
                        <h3 class="message-title">
                            <div style="display: flex;align-items: center;">
                                <!-- 通知消息显示未读标记 -->
                                <nz-badge nzStatus="error" *ngIf="selectedChannelIndex === 0 && item.status == NoticeStatus.UNREAD"></nz-badge>
                                <!-- 根据类型显示标题 -->
                                <span>{{ selectedChannelIndex === 0 ? item.noticeLog?.title : item.title }}</span>
                                <!-- URL 图标 -->
                                <span nz-icon
                                      nzType="link"
                                      nzTheme="outline"
                                      *ngIf="selectedChannelIndex === 0 && item.noticeLog?.url"
                                      (click)="openUrlDrawer(item.noticeLog.url, item.noticeLog.title || ''); $event.stopPropagation()"
                                      style="margin-left: 8px; cursor: pointer; color: #1890ff;"
                                      nz-tooltip>
                                </span>
                                <!-- 根据类型显示时间 -->
                                <span style="font-size: .7em;margin-left: auto">
                                    {{ (selectedChannelIndex === 0 ? item.noticeLog?.createTime : item.createTime) | date:'yyyy-MM-dd HH:mm:ss' }}
                                </span>
                            </div>
                        </h3>
                    </div>
                    <!-- 根据类型显示内容 -->
                    <p class="message-content"
                       *ngIf="selectedChannelIndex === 0 ? item.noticeLog?.content : item.content"
                       [innerHTML]="(selectedChannelIndex === 0 ? item.noticeLog?.content : item.content) | safeHtml">
                    </p>
                </div>
            </nz-list-item>
        </nz-list>

        <!-- 分页 -->
        <div class="notice-pagination" *ngIf="total > 0">
            <nz-pagination
                [nzPageIndex]="pageIndex"
                [nzPageSize]="pageSize"
                [nzTotal]="total"
                [nzSize]="'small'"
                [nzShowSizeChanger]="false"
                (nzPageIndexChange)="onPageIndexChange($event)">
            </nz-pagination>
        </div>
    </div>

</div>
